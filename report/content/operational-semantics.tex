\section{Operational Semantics}

\begin{notation}
Let $c$ be a command and $\sigma'$, $\varepsilon$ and $\omega'$ be the state, exception and heap after the execution of $c$ in $\rho$, $\sigma$ and $\omega$.

This is written:
\begin{equation}
(c,\rho,\sigma,\omega) \Downarrow (\sigma',\epsilon,\omega')
\end{equation}
\end{notation}

\begin{notation}
Let $a$ be an arithmetic expression and $n\in\mathbb{N}$ be the result of evaluating $a$ in $\sigma$.

This is written:
\begin{equation}
(a,\sigma) \Downarrow n
\end{equation}
\end{notation}

\begin{notation}
Let $b$ be a boolean expression and $\beta$ the boolean result of evaluating $b$ in $\sigma$.

This is written:
\begin{equation}
(b,\sigma) \Downarrow \beta
\end{equation}
\end{notation}

Below follows the operational semantics for all commands in IMP+.

\begin{equation}
\frac{}{(\textbf{SKIP}, \rho, \sigma, \omega) \Downarrow (\sigma, \bot, \omega)}
\end{equation}

\begin{equation}
\frac{(a, \sigma) \Downarrow n \qquad \sigma' = \sigma[\sfrac{X}{n}]}{((X ::= a), \rho, \sigma, \omega) \Downarrow (\sigma', \bot, \omega)}
\end{equation}

\begin{equation}
\frac{(b, \sigma) \Downarrow true \qquad (c_1, \rho, \sigma, \omega) \Downarrow (\sigma', \varepsilon, \omega')}{((\textbf{IFB}\; b\; \textbf{THEN}\; c_1\; \textbf{ELSE}\; c_2\; \textbf{FI}), \rho, \sigma, \omega) \Downarrow (\sigma', \varepsilon, \omega')}
\end{equation}

\begin{equation}
\frac{(b, \sigma) \Downarrow false \qquad (c_2, \rho, \sigma, \omega) \Downarrow (\sigma', \varepsilon, \omega')}{((\textbf{IFB}\; b\; \textbf{THEN}\; c_1\; \textbf{ELSE}\; c_2\; \textbf{FI}), \rho, \sigma, \omega) \Downarrow (\sigma', \varepsilon, \omega')}
\end{equation}

\begin{equation}
\frac{(c_1, \rho, \sigma, \omega) \Downarrow (\sigma', \bot, \omega') \qquad (c_2, \rho, \sigma', \omega') \Downarrow (\sigma'', \bot, \omega'')}{((c_1\; ;;\; c_2), \rho, \sigma, \omega) \Downarrow (\sigma'', \bot, \omega'')}
\end{equation}

\begin{equation}
\frac{(c_1, \rho, \sigma, \omega) \Downarrow (\sigma', \bot, \omega') \qquad (c_2, \rho, \sigma', \omega') \Downarrow (\sigma'', \varepsilon, \omega'') \qquad \varepsilon \neq \bot}{((c_1\; ;;\; c_2), \rho, \sigma, \omega) \Downarrow (\sigma'', \varepsilon, \omega'')}
\end{equation}

\begin{equation}
\frac{(c_1, \rho, \sigma, \omega) \Downarrow (\sigma', \varepsilon, \omega') \qquad \varepsilon \neq \bot}{((c_1\; ;;\; c_2), \rho, \sigma, \omega) \Downarrow (\sigma', \varepsilon, \omega')}
\end{equation}

\begin{equation}
\frac{(b, \sigma) \Downarrow false}{((\textbf{WHILE}\; b\; \textbf{DO}\; c\; \textbf{END}), \rho, \sigma, \omega) \Downarrow (\sigma, \bot, \omega)}
\end{equation}

\begin{equation}
\frac{(b, \sigma) \Downarrow true \qquad (c, \rho, \sigma, \omega) \Downarrow (\sigma', \bot, \omega') \qquad ((\textbf{WHILE}\; b\; \textbf{DO}\; c\; \textbf{END}), \rho, \sigma', \omega') \Downarrow (\sigma'', \bot, \omega'')}{((\textbf{WHILE}\; b\; \textbf{DO}\; c\; \textbf{END}), \rho, \sigma, \omega) \Downarrow (\sigma'', \bot, \omega'')}
\end{equation}

\begin{equation}
\frac{(b, \sigma) \Downarrow true \qquad (c, \rho, \sigma, \omega) \Downarrow (\sigma', \varepsilon, \omega') \qquad \varepsilon \neq \bot}{((\textbf{WHILE}\; b\; \textbf{DO}\; c\; \textbf{END}), \rho, \sigma, \omega) \Downarrow (\sigma', \varepsilon, \omega')}
\end{equation}

\begin{equation}
\frac{(\tilde{a}, \sigma) \Downarrow \tilde{n}}{((\textbf{THROW}\; e,\; \tilde{a}), \rho, \sigma, \omega) \Downarrow (\sigma, (e, \tilde{n}), \omega)}
\end{equation}

\begin{equation}
\frac{(c_1, \rho, \sigma, \omega) \Downarrow (\sigma', \bot, \omega')}{((\textbf{TRY}\; c_1\; \textbf{CATCH}\; e,\; \tilde{X}\; \textbf{DO}\; c_2\; \textbf{END}), \rho, \sigma, \omega) \Downarrow (\sigma', \bot, \omega')}
\end{equation}

\begin{equation}
\frac{(c_1, \rho, \sigma, \omega) \Downarrow (\sigma', (e, \tilde{n}), \omega') \qquad (c_2, \rho, \sigma[\sfrac{\tilde{X}}{\tilde{n}}], \omega) \Downarrow (\sigma'', \varepsilon, \omega'')}{((\textbf{TRY}\; c_1\; \textbf{CATCH}\; e,\; \tilde{X}\; \textbf{DO}\; c_2\; \textbf{END}), \rho, \sigma, \omega) \Downarrow (\sigma'', \varepsilon, \omega'')}
\end{equation}

\begin{equation}
\frac{e \neq e' \qquad (c_1, \rho, \sigma, \omega) \Downarrow (\sigma', (e, \tilde{n}), \omega')}{((\textbf{TRY}\; c_1\; \textbf{CATCH}\; e',\; \tilde{X}\; \textbf{DO}\; c_2\; \textbf{END}), \rho, \sigma, \omega) \Downarrow (\sigma', (e, \tilde{n}), \omega')}
\end{equation}

\begin{equation}
\frac
{(\tilde{a},\sigma) \Downarrow \tilde{v} \quad \sigma''= emp[\sfrac{\tilde{v}}{\tilde{p}}] \quad (c, \rho, \sigma'', \omega) \Downarrow (\sigma''', \varepsilon, \omega') \quad (r,\sigma''') \Downarrow w \quad \sigma' = \sigma[\sfrac{X}{w}] \quad \rho(f) = (c, \tilde{p}, r)}
{((\textbf{CALL}\; F \; X  \; \tilde{a}), \rho, \sigma, \omega) \Downarrow (\sigma', \varepsilon, \omega')}
\end{equation}